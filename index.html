<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>La Cantoche ‚Äì Roue des cadeaux</title>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #111;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 10px;
}

header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin: 20px 0;
  flex-wrap: wrap;
}

header img {
  height: 60px;
}

header h1 {
  font-size: 24px;
  margin: 0;
}

.instructions {
  text-align: center;
  max-width: 90%;
  font-size: 14px;
  line-height: 1.4;
  margin-bottom: 15px;
}

.instructions strong {
  color: #f4c430;
}

.wheel-container {
  position: relative;
  width: 90vw;
  max-width: 400px;
  height: 90vw;
  max-height: 400px;
  border-radius: 50%;
  overflow: hidden;
}

canvas {
  width: 100%;
  height: 100%;
  display: block;
}

.arrow {
  position: absolute;
  top: -20px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 32px;
  z-index: 10;
}

button, a {
  margin-top: 10px;
  padding: 12px 20px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  text-decoration: none;
  display: inline-block;
}

button {
  background: #f4c430;
  color: #000;
}

button:disabled {
  background: #555;
  cursor: not-allowed;
}

a {
  background:#4285F4;
  color:white;
}

.result {
  margin-top: 20px;
  font-size: 18px;
  text-align: center;
}
</style>
</head>
<body>

<header>
  <img src="https://i.postimg.cc/yYY3Tvqd/Logo-La-Cantoche-mono-Original-Plan-de-travail-1-copie.png" alt="Logo La Cantoche">
  <h1>La Cantoche</h1>
</header>

<div class="instructions">
  ‚≠ê <strong>Laissez-nous un avis Google</strong><br>
  üëÄ Montrez-le √† un membre de l‚Äô√©quipe avant de tourner la roue<br>
  üé° Tournez la roue avec lui<br>
  üéÅ Les lots peuvent √™tre imm√©diats ou √† utiliser lors de votre prochaine visite
</div>

<a href="https://www.google.com/maps/place/La+Cantoche+des+Grands+Enfants/@43.3167844,-0.4357252,17z/data=!4m8!3m7!1s0xd564ff89a35d0b7:0xd1257e99a132c8e7!8m2!3d43.3167805!4d-0.4331503!9m1!1b1!16s%2Fg%2F11np3gtrwy?entry=ttu&g_ep=EgoyMDI2MDEwNi4wIKXMDSoASAFQAw%3D%3D" target="_blank">‚≠ê Laisser un avis Google</a>

<div class="wheel-container">
  <div class="arrow">‚¨áÔ∏è</div>
  <canvas id="wheel"></canvas>
</div>

<button id="confirmBtn">J'ai laiss√© mon avis</button>
<button id="spinBtn" disabled>Tourner la roue üé°</button>

<div class="result" id="result"></div>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");

// ‚ö° Initialisation stable du canvas
function initCanvas() {
  const size = Math.min(window.innerWidth*0.9, 400); // max 400px desktop
  canvas.width = size;
  canvas.height = size;
}
initCanvas();

// Redessine seulement quand la fen√™tre change, pas pendant le spin
window.addEventListener("resize", ()=>{
  const size = Math.min(window.innerWidth*0.9, 400);
  canvas.width = size;
  canvas.height = size;
  drawWheel(); // redraw stable
});

// Segments et probabilit√©s
const segments = [
  { label: "Caf√© offert", weight: 50 },
  { label: "Cookie Nutella", weight: 5 },
  { label: "Boisson offerte", weight: 5 },
  { label: "Menu enfant", weight: 5 },
  { label: "Pas de gain", weight: 35 }
];

// Cr√©e 20 segments selon les probabilit√©s
let wheelSegments = [];
segments.forEach((seg, index) => {
  const count = Math.round(seg.weight / 5); // 5% par segment
  for(let i=0;i<count;i++) wheelSegments.push(index);
});

// M√©lange les segments pour surprise
function shuffle(array) {
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
}
shuffle(wheelSegments);

const total = wheelSegments.length;
const colors = ["#F44336","#FF9800","#FFEB3B","#4CAF50","#2196F3","#9C27B0","#E91E63","#00BCD4"];

// Dessine la roue
function drawWheel() {
  const center = canvas.width/2;
  const radius = center;
  const angle = 2*Math.PI/total;

  for(let i=0;i<total;i++){
    ctx.beginPath();
    ctx.moveTo(center,center);
    ctx.arc(center,center,radius,angle*i,angle*(i+1));
    ctx.fillStyle = colors[i % colors.length];
    ctx.fill();
    ctx.strokeStyle = "#111";
    ctx.lineWidth = 2;
    ctx.stroke();
  }
}
drawWheel();

const confirmBtn = document.getElementById("confirmBtn");
const spinBtn = document.getElementById("spinBtn");
const resultDiv = document.getElementById("result");

confirmBtn.addEventListener("click",()=>{
  spinBtn.disabled=false;
  confirmBtn.disabled=true;
});

// Tirage pond√©r√©
function weightedRandom() {
  const totalWeight = segments.reduce((sum,s)=>sum+s.weight,0);
  let r = Math.random()*totalWeight;
  for(let i=0;i<segments.length;i++){
    if(r<segments[i].weight) return i;
    r-=segments[i].weight;
  }
}

spinBtn.addEventListener("click",()=>{
  spinBtn.disabled=true;
  resultDiv.textContent="";

  const finalLot = weightedRandom();

  // Indices possibles sur la roue
  const possibleIndexes = [];
  wheelSegments.forEach((seg,i)=>{ if(seg===finalLot) possibleIndexes.push(i); });
  const chosenIndex = possibleIndexes[Math.floor(Math.random()*possibleIndexes.length)];

  // Calcul rotation
  const targetAngle = (360/total)*chosenIndex;
  const spins = 5*360;
  const finalAngle = spins + (360 - targetAngle - (360/total)/2);

  let currentRotation = 0;
  const duration = 4000;
  let startTime = null;

  function animate(timestamp){
    if(!startTime) startTime=timestamp;
    const progress = timestamp-startTime;
    const t = Math.min(progress/duration,1);
    const ease = 1 - Math.pow(1-t,3);
    currentRotation = finalAngle*ease;

    // üîπ Ne touche pas √† la taille du canvas ici
    ctx.setTransform(1,0,0,1,0,0);
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.translate(canvas.width/2,canvas.height/2);
    ctx.rotate(currentRotation*Math.PI/180);
    ctx.translate(-canvas.width/2,-canvas.height/2);
    drawWheel();

    if(t<1){
      requestAnimationFrame(animate);
    } else {
      resultDiv.textContent="üéâ R√©sultat : "+segments[finalLot].label;
    }
  }
  requestAnimationFrame(animate);
});
</script>

</body>
</html>