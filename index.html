<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>La Cantoche ‚Äì Roue des cadeaux</title>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#111;
  color:#fff;
  display:flex;
  flex-direction:column;
  align-items:center;
}

header {
  margin:15px 0;
  text-align:center;
}
header img {
  height:70px;
}
header h1 {
  margin:5px 0 0;
  font-size:24px;
}

.instructions {
  text-align:center;
  font-size:14px;
  max-width:320px;
  margin-bottom:10px;
}
.instructions strong { color:#ffbf3f; }

.wheel-container {
  position:relative;
  width:280px;
  height:280px;
}

canvas { width:100%; height:100%; }

.arrow {
  position:absolute;
  top:-12px;
  left:50%;
  transform:translateX(-50%);
  font-size:26px;
}

button, .link-avis {
  margin-top:10px;
  padding:10px 18px;
  font-size:16px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

button:disabled {
  background:#555;
  color:#999;
}

/* Lien pour avis Google */
.link-avis {
  background:#00205b;
  color:#fff;
  text-decoration:none;
  display:inline-block;
}

/* Popup */
.popup {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.7);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}
.popup-content {
  background:#fff;
  color:#000;
  padding:20px;
  border-radius:12px;
  width:80%;
  max-width:300px;
  text-align:center;
}
.popup-content h2 { margin-top:0; }
.popup-content button {
  margin-top:15px;
  padding:10px 18px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#ffbf3f;
  cursor:pointer;
}
</style>
</head>
<body>

<header>
  <img src="https://lacantochelescar.fr/wp-content/uploads/2021/06/LA-CANTOCHE-LOGO-HEADER.png" alt="La Cantoche">
  <h1>La Cantoche</h1>
</header>

<div class="instructions">
  ‚≠ê <strong>Laissez-nous un avis Google</strong><br>
  üëÄ Montrez-le √† un membre de l‚Äô√©quipe<br>
  üé° Tournez la roue avec lui<br>
  üéÅ <strong>Les lots sont imm√©diats</strong>
</div>

<a href="https://www.google.fr/maps/place/La+Cantoche+des+Grands+Enfants/@43.3167844,-0.4357252,17z/data=!4m8!3m7!1s0xd564ff89a35d0b7:0xd1257e99a132c8e7!8m2!3d43.3167805!4d-0.4331503!9m1!1b1!16s%2Fg%2F11np3gtrwy?entry=ttu&g_ep=EgoyMDI2MDExMy4wIKXMDSoASAFQAw%3D%3D" class="link-avis" target="_blank">‚≠ê Laisser un avis Google</a>

<div class="wheel-container">
  <div class="arrow">‚¨áÔ∏è</div>
  <canvas id="wheel" width="500" height="500"></canvas>
</div>

<button id="confirmBtn">J'ai laiss√© mon avis</button>
<button id="spinBtn" disabled>Tourner la roue üé°</button>

<!-- Popup -->
<div class="popup" id="popup">
  <div class="popup-content">
    <h2>üéâ R√©sultat</h2>
    <p id="popupResult"></p>
    <button onclick="closePopup()">OK</button>
  </div>
</div>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");

const rewards = [
  "Caf√© offert",
  "Cookie Nutella",
  "Boisson offerte",
  "Menu enfant offert",
  "Pas de gain"
];

// Probabilit√©s sur 20 cases
const wheelSegments = [
  0,0,0,0,0,0,0,0,0,0, // Caf√© 50%
  1, // Cookie 5%
  2, // Boisson 5%
  3, // Menu 5%
  4,4,4,4,4,4,4 // Pas de gain 35%
];

// M√©lange pour que les cases ne soient pas regroup√©es
wheelSegments.sort(()=>Math.random()-0.5);

const total = wheelSegments.length;
const angle = (2*Math.PI)/total;

function drawWheel(){
  for(let i=0;i<total;i++){
    ctx.beginPath();
    ctx.moveTo(250,250);
    ctx.arc(250,250,250,angle*i,angle*(i+1));
    ctx.fillStyle = i%2===0 ? "#ffbf3f" : "#957241";
    ctx.fill();
  }
}
drawWheel();

const confirmBtn = document.getElementById("confirmBtn");
const spinBtn = document.getElementById("spinBtn");

confirmBtn.onclick = ()=>{
  spinBtn.disabled=false;
  confirmBtn.disabled=true;
};

spinBtn.onclick = ()=>{
  spinBtn.disabled=true;

  const index = Math.floor(Math.random()*total);
  const reward = rewards[wheelSegments[index]];

  const target = (360/total)*index;
  const final = 5*360 + (360-target);

  let start=null;

  function anim(t){
    if(!start) start=t;
    const p = Math.min((t-start)/4000,1);
    const ease = 1-Math.pow(1-p,3);
    const rot = final*ease;

    ctx.setTransform(1,0,0,1,0,0);
    ctx.clearRect(0,0,500,500);
    ctx.translate(250,250);
    ctx.rotate(rot*Math.PI/180);
    ctx.translate(-250,-250);
    drawWheel();

    if(p<1) requestAnimationFrame(anim);
    else showPopup(reward);
  }
  requestAnimationFrame(anim);
};

function showPopup(text){
  document.getElementById("popupResult").textContent = text;
  document.getElementById("popup").style.display="flex";
}
function closePopup(){
  document.getElementById("popup").style.display="none";
  confirmBtn.disabled=false;
}
</script>

</body>
</html>