<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>La Cantoche ‚Äì Roue des cadeaux</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #111;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
}

header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin: 20px 0;
}

header img {
  height: 60px;
}

header h1 {
  font-size: 28px;
  margin: 0;
}

.instructions {
  text-align: center;
  max-width: 320px;
  font-size: 15px;
  line-height: 1.4;
  margin-bottom: 15px;
}

.instructions strong {
  color: #f4c430;
}

.wheel-container {
  position: relative;
  width: 320px;
  height: 320px;
}

canvas {
  width: 100%;
  height: 100%;
}

.arrow {
  position: absolute;
  top: -12px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 28px;
}

button {
  margin-top: 20px;
  padding: 12px 24px;
  font-size: 18px;
  border-radius: 8px;
  border: none;
  background: #f4c430;
  color: #000;
  cursor: pointer;
}

button:disabled {
  background: #555;
  cursor: not-allowed;
}

.result {
  margin-top: 20px;
  font-size: 20px;
  text-align: center;
}
</style>
</head>

<body>

<header>
  <img src="https://i.postimg.cc/yYY3Tvqd/Logo-La-Cantoche-mono-Original-Plan-de-travail-1-copie.png" alt="Logo La Cantoche">
  <h1>La Cantoche</h1>
</header>

<div class="instructions">
  ‚≠ê <strong>Laissez-nous un avis Google</strong><br>
  üëÄ Montrez-le √† un membre de l‚Äô√©quipe<br>
  üé° Tournez la roue avec lui
</div>

<div class="wheel-container">
  <div class="arrow">‚¨áÔ∏è</div>
  <canvas id="wheel" width="500" height="500"></canvas>
</div>

<button id="spinBtn">Tourner la roue üé°</button>

<div class="result" id="result"></div>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");

const segments = [
  { emoji: "‚òï", label: "Caf√© offert" },
  { emoji: "üç™", label: "Cookie Nutella" },
  { emoji: "ü•§", label: "Boisson offerte (hors alcool fort)" },
  { emoji: "üßí", label: "Menu enfant offert (prochaine visite)" },
  { emoji: "üòÖ", label: "Pas de gain cette fois-ci" }
];

// Probabilit√©s r√©elles (non visibles)
const weightedResults = [
  ...Array(50).fill(0), // Caf√© 50%
  ...Array(5).fill(1),  // Cookie 5%
  ...Array(5).fill(2),  // Boisson 5%
  ...Array(5).fill(3),  // Menu enfant 5%
  ...Array(35).fill(4)  // Pas de gain 35%
];

const colors = ["#C9A24D", "#D2691E", "#4FC3F7", "#81C784", "#9E9E9E"];
const total = segments.length;
const angle = (2 * Math.PI) / total;

let currentRotation = 0;
let spinning = false;

function drawWheel() {
  for (let i = 0; i < total; i++) {
    ctx.beginPath();
    ctx.moveTo(250, 250);
    ctx.arc(250, 250, 250, angle * i, angle * (i + 1));
    ctx.fillStyle = colors[i];
    ctx.fill();
    ctx.save();
    ctx.translate(250, 250);
    ctx.rotate(angle * (i + 0.5));
    ctx.textAlign = "right";
    ctx.font = "40px Arial";
    ctx.fillStyle = "#000";
    ctx.fillText(segments[i].emoji, 220, 15);
    ctx.restore();
  }
}

drawWheel();

document.getElementById("spinBtn").addEventListener("click", () => {
  if (spinning) return;
  spinning = true;
  document.getElementById("result").textContent = "";

  const chosenIndex = weightedResults[Math.floor(Math.random() * weightedResults.length)];
  const targetAngle = (360 / total) * chosenIndex;
  const spins = 5 * 360;
  const finalAngle = spins + (360 - targetAngle - (360 / total) / 2);

  let start = currentRotation;
  let end = finalAngle;
  let duration = 4000;
  let startTime = null;

  function animate(timestamp) {
    if (!startTime) startTime = timestamp;
    const progress = timestamp - startTime;
    const t = Math.min(progress / duration, 1);
    const ease = 1 - Math.pow(1 - t, 3);
    currentRotation = start + (end - start) * ease;
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.clearRect(0, 0, 500, 500);
    ctx.translate(250, 250);
    ctx.rotate((currentRotation * Math.PI) / 180);
    ctx.translate(-250, -250);
    drawWheel();

    if (t < 1) {
      requestAnimationFrame(animate);
    } else {
      spinning = false;
      document.getElementById("result").textContent =
        "üéâ R√©sultat : " + segments[chosenIndex].label;
    }
  }

  requestAnimationFrame(animate);
});
</script>

</body>
</html>
